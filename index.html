<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>EmpireClick - Conquer the World</title>
    
    <!-- Loading Screen Styles -->
    <style>
        #loadingScreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea, #764ba2);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.5s ease-out;
            overflow: hidden;
        }
        
        /* Floating kingdom elements */
        .loading-decoration {
            position: absolute;
            font-size: 2rem;
            opacity: 0.3;
            animation: float 6s ease-in-out infinite;
        }
        
        .loading-decoration:nth-child(1) { top: 10%; left: 10%; animation-delay: 0s; }
        .loading-decoration:nth-child(2) { top: 20%; right: 15%; animation-delay: 1s; }
        .loading-decoration:nth-child(3) { top: 60%; left: 5%; animation-delay: 2s; }
        .loading-decoration:nth-child(4) { top: 70%; right: 10%; animation-delay: 3s; }
        .loading-decoration:nth-child(5) { top: 40%; left: 20%; animation-delay: 4s; }
        .loading-decoration:nth-child(6) { top: 30%; right: 25%; animation-delay: 5s; }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(10deg); }
        }
        
        .loading-logo {
            font-size: 3.5rem;
            font-weight: bold;
            color: white;
            text-shadow: 0 4px 8px rgba(0,0,0,0.3), 0 0 20px rgba(255, 215, 0, 0.5);
            margin-bottom: 2rem;
            animation: logoGlow 2s ease-in-out infinite alternate;
            border: 2px solid white;
            padding: 20px 40px;
            border-radius: 15px;
            background: rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
        }
        
        @keyframes logoGlow {
            from { text-shadow: 0 0 20px rgba(255, 215, 0, 0.5); }
            to { text-shadow: 0 0 30px rgba(255, 215, 0, 0.8), 0 0 40px rgba(255, 215, 0, 0.3); }
        }
        
        .loading-message {
            font-size: 1.5rem;
            color: white;
            text-align: center;
            margin-bottom: 2rem;
            min-height: 2rem;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.5s ease;
        }
        
        .loading-message.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        .loading-progress {
            width: 300px;
            height: 12px;
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid white;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 1rem;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .loading-bar {
            height: 100%;
            background: linear-gradient(90deg, #ff6b6b, #ff8e53, #ffd700);
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
        }
        
        .loading-percentage {
            font-size: 1rem;
            color: #ffd700;
            font-weight: bold;
        }
        
        .loading-subtitle {
            font-size: 1rem;
            color: white;
            margin-top: 1rem;
            text-align: center;
            font-weight: bold;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
            background: rgba(255,255,255,0.1);
            padding: 10px 20px;
            border-radius: 20px;
            border: 1px solid rgba(255,255,255,0.3);
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top: 3px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.3);
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .loading-messages {
            position: absolute;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.8rem;
        }
        
        .loading-tip {
            opacity: 0;
            transition: opacity 0.5s ease;
        }
        
        .loading-tip.show {
            opacity: 1;
        }
        
        @media (max-width: 768px) {
            .loading-logo {
                font-size: 2.5rem;
            }
            
            .loading-message {
                font-size: 1.2rem;
            }
            
            .loading-progress {
                width: 250px;
            }
        }
    </style>
    
    <!-- Admin Access System -->
    <style>
        .admin-link {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.3);
            color: #ccc;
            padding: 5px 8px;
            border-radius: 5px;
            font-size: 10px;
            text-decoration: none;
            opacity: 0.3;
            transition: opacity 0.3s;
            z-index: 1000;
        }
        .admin-link:hover {
            opacity: 1;
            color: #fff;
        }

        /* Admin Login Modal */
        .admin-login-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 9999;
            backdrop-filter: blur(5px);
        }

        .admin-login-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #667eea, #764ba2);
            border: 2px solid #fff;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
            min-width: 350px;
            text-align: center;
        }

        .admin-login-content h2 {
            color: white;
            margin: 0 0 20px 0;
            font-size: 1.5rem;
        }

        .admin-login-content input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 2px solid #fff;
            border-radius: 8px;
            background: rgba(255,255,255,0.9);
            color: #333;
            font-weight: bold;
            box-sizing: border-box;
        }

        .admin-login-content button {
            background: linear-gradient(135deg, #ff6b6b, #ff8e53);
            border: 2px solid #fff;
            color: white;
            font-weight: bold;
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            margin: 5px;
            transition: transform 0.2s;
        }

        .admin-login-content button:hover {
            transform: scale(1.05);
        }

        .admin-login-content .error {
            color: #ff6b6b;
            font-weight: bold;
            margin: 10px 0;
        }

        .admin-login-content .success {
            color: #22c55e;
            font-weight: bold;
            margin: 10px 0;
        }

        .admin-shortcut-hint {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0,0,0,0.7);
            color: #ccc;
            padding: 8px 12px;
            border-radius: 8px;
            font-size: 12px;
            opacity: 0.6;
            transition: opacity 0.3s;
        }

        .admin-shortcut-hint:hover {
            opacity: 1;
        }
    </style>
    <link rel="stylesheet" href="styles.css" />
    
    <!-- BOOST + REVEMPIRE UI PATCH STYLES -->
    <style>
      /* ====== BOOST + CHIP STYLING ====== */
      .boost-row { display:flex; gap:10px; align-items:center; margin-top:8px; }
      .chip {
        display:inline-flex; align-items:center; gap:8px;
        padding:6px 10px; border-radius:999px; font-weight:700;
        background:linear-gradient(145deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));
        border:1px solid rgba(255,255,255,0.12); color:#fff;
        box-shadow: 0 4px 10px rgba(0,0,0,.25), inset 0 1px 0 rgba(255,255,255,.06);
        backdrop-filter: blur(4px);
      }
      .chip-boost { border-color:#ff9f1a; box-shadow: 0 0 16px rgba(255,159,26,.25); }
      .chip-tax   { border-color:#66e6a5; box-shadow: 0 0 16px rgba(102,230,165,.2); }
      .chip-sep   { opacity:.6; }

      /* ====== TOASTS ====== */
      .toast-container {
        position: fixed; right: 24px; bottom: 24px; z-index: 3000;
        display: flex; flex-direction: column; gap: 10px; pointer-events: none;
      }
      .toast {
        pointer-events:auto;
        min-width: 260px; max-width: 380px;
        background: linear-gradient(145deg, rgba(0,0,0,.88), rgba(0,0,0,.8));
        color: #fff; border: 1px solid rgba(255,255,255,.12);
        border-left: 4px solid #ff9f1a;
        padding: 12px 14px; border-radius: 12px;
        box-shadow: 0 10px 24px rgba(0,0,0,.45); backdrop-filter: blur(8px);
        animation: toast-in .25s ease-out;
      }
      .toast.success { border-left-color: #66e6a5; }
      .toast.warn    { border-left-color: #ffb533; }
      .toast.error   { border-left-color: #ff4d4d; }
      @keyframes toast-in { from { opacity:0; transform: translateY(6px) scale(.98);} to { opacity:1; transform: none; } }
    </style>
    
    <!-- ========= EmpireClick UI Polish Pack ========= -->
    <style>
      :root{
        --ui-bg: 12 12 16;
        --ui-card: 22 22 28;
        --ui-accent: 255 184 77;   /* gold */
        --ui-accent-2: 93 156 236; /* royal blue */
        --ui-text: 240 240 248;
        --ui-muted: 170 170 182;

        --glass-bg: rgba(20,20,28,0.6);
        --glass-border: rgba(255,255,255,0.08);
        --glow: 0 8px 24px rgba(0,0,0,0.55);

        --z-base: 10;
        --z-tooltip: 900;
        --z-toast: 1200;
        --z-modal: 1400;
        --z-message: 1500;
      }

      .ec-glass {
        background: linear-gradient(135deg, #667eea, #764ba2);
        border: 2px solid #fff;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.4);
        backdrop-filter: blur(10px);
        color: white;
        font-weight: bold;
      }

      .ec-title {
        font-weight: 700;
        letter-spacing: .3px;
        color: white;
        font-size: 1.2rem;
        text-align: center;
        margin-bottom: 15px;
      }
      
      /* Beautiful panel styling */
      .panel {
        background: linear-gradient(135deg, #667eea, #764ba2);
        border: 2px solid #fff;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.4);
        color: white;
        font-weight: bold;
        margin-bottom: 15px;
      }
      
      .panel h3 {
        color: white;
        font-size: 1.3rem;
        text-align: center;
        margin-bottom: 15px;
        text-shadow: 0 2px 4px rgba(0,0,0,0.3);
      }
      
      .panel button {
        background: linear-gradient(135deg, #ff6b6b, #ff8e53);
        border: 2px solid #fff;
        color: white;
        font-weight: bold;
        padding: 12px 20px;
        border-radius: 10px;
        cursor: pointer;
        transition: transform 0.2s;
        margin: 5px;
      }
      
      .panel button:hover {
        transform: scale(1.05);
      }

      /* Plot Info Panel (uses existing #plotInfoPanel) */
      .plot-info-panel {
        position: fixed;
        right: 20px;
        bottom: 20px;
        z-index: var(--z-message);
        display: none;
        min-width: 280px;
        padding: 20px;
        border: 2px solid #fff;
        border-radius: 15px;
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        font-weight: bold;
        box-shadow: 0 10px 30px rgba(0,0,0,0.4);
        animation: eventSlideIn 0.5s ease-out;
      }
      .plot-info-panel .label { color: rgba(255,255,255, .9); font-size: .9rem; }
      .plot-info-panel .value { font-weight: bold; color: white; }
      .plot-info-panel .row { display: grid; grid-template-columns: 90px 1fr; gap: 8px; margin: 6px 0; }
      .plot-info-panel .tag {
        display: inline-flex; align-items: center; gap: 6px;
        padding: 6px 12px; border-radius: 999px;
        background: rgba(255,255,255, .2);
        border: 1px solid rgba(255,255,255, .5);
        color: white;
        font-size: .9rem;
        font-weight: bold;
      }

      /* Modal polish (uses existing .modal containers) */
      .modal {
        position: fixed; inset: 0; display: none; z-index: var(--z-modal);
        align-items: center; justify-content: center;
      }
      .modal.is-open { display: flex; }
      .modal::before {
        content: ""; position: absolute; inset: 0;
        background: rgba(0,0,0,.7); backdrop-filter: blur(5px);
      }
      .modal .modal-content {
        position: relative; z-index: 1; width: min(720px, 92vw);
        padding: 25px;
        border: 2px solid #fff;
        border-radius: 20px;
        background: linear-gradient(135deg, #667eea, #764ba2);
        color: white;
        font-weight: bold;
        box-shadow: 0 20px 40px rgba(0,0,0,0.5);
        animation: eventSlideIn 0.5s ease-out;
      }
      .modal .modal-content h3 {
        color: white;
        font-size: 1.5rem;
        margin-bottom: 20px;
        text-align: center;
      }
      .modal .modal-content button {
        background: linear-gradient(135deg, #ff6b6b, #ff8e53);
        border: 2px solid #fff;
        color: white;
        font-weight: bold;
        padding: 12px 20px;
        border-radius: 10px;
        cursor: pointer;
        transition: transform 0.2s;
      }
      .modal .modal-content button:hover {
        transform: scale(1.05);
      }

      @keyframes ecPop {
        from { transform: translateY(8px) scale(.98); opacity: 0; }
        to   { transform: translateY(0) scale(1); opacity: 1; }
      }

      /* Game Message (uses existing #gameMessage) */
      #gameMessage {
        position: fixed; left: 50%; top: 6%;
        transform: translateX(-50%);
        z-index: var(--z-message);
        display: none;
        padding: 20px 25px;
        border: 2px solid #fff;
        border-radius: 15px;
        background: linear-gradient(135deg, #ff6b6b, #ff8e53);
        color: white;
        font-weight: bold;
        font-size: 1.1rem;
        box-shadow: 0 10px 30px rgba(0,0,0,0.4);
        animation: eventSlideIn 0.5s ease-out;
        min-width: 300px;
        text-align: center;
      }

      /* Toasts */
      .ec-toast-container {
        position: fixed; left: 50%; bottom: 24px; transform: translateX(-50%);
        z-index: var(--z-toast);
        display: flex; flex-direction: column; gap: 10px; align-items: center;
      }
      .ec-toast {
        min-width: 300px; max-width: 600px;
        padding: 15px 20px; border-radius: 15px;
        border: 2px solid #fff;
        color: white;
        font-weight: bold;
        font-size: 1rem;
        box-shadow: 0 10px 30px rgba(0,0,0,0.4);
        animation: eventSlideIn 0.5s ease-out;
        text-align: center;
      }
      .ec-toast.success { 
        background: linear-gradient(135deg, #22c55e, #16a34a);
      }
      .ec-toast.error   { 
        background: linear-gradient(135deg, #ef4444, #dc2626);
      }
      .ec-toast.info    { 
        background: linear-gradient(135deg, #3b82f6, #2563eb);
      }

      @keyframes toastIn {
        from { opacity: 0; transform: translateY(8px); }
        to   { opacity: 1; transform: translateY(0); }
      }

      /* Tooltips (optional helper class) */
      .ec-tip {
        position: absolute; z-index: var(--z-tooltip);
        padding: 6px 8px; border-radius: 8px;
        background: rgba(0,0,0,.85); color: #fff; font-size: 12px;
        border: 1px solid rgba(255,255,255,.08);
        box-shadow: 0 8px 18px rgba(0,0,0,.45);
      }

      /* Motion respect */
      @media (prefers-reduced-motion: reduce){
        * { animation: none !important; transition: none !important; }
      }
      
      /* Event Notification Banner */
      .event-notification {
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        z-index: var(--z-message);
        background: linear-gradient(135deg, #ff6b6b, #ff8e53);
        border: 2px solid #fff;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.4);
        animation: eventSlideIn 0.5s ease-out;
        min-width: 400px;
        max-width: 600px;
      }
      
      .event-notification-content {
        display: flex;
        align-items: center;
        padding: 15px 20px;
        color: white;
        font-weight: bold;
      }
      
      .event-icon {
        font-size: 2rem;
        margin-right: 15px;
        animation: eventPulse 2s infinite;
      }
      
      .event-info {
        flex: 1;
      }
      
      .event-title {
        font-size: 0.9rem;
        opacity: 0.9;
        margin-bottom: 2px;
      }
      
      .event-name {
        font-size: 1.2rem;
        margin-bottom: 2px;
      }
      
      .event-timer {
        font-size: 0.9rem;
        opacity: 0.8;
      }
      
      .event-close-btn {
        background: none;
        border: none;
        color: white;
        font-size: 1.2rem;
        cursor: pointer;
        padding: 5px;
        border-radius: 50%;
        transition: background 0.2s;
      }
      
      .event-close-btn:hover {
        background: rgba(255,255,255,0.2);
      }
      
      @keyframes eventSlideIn {
        from {
          opacity: 0;
          transform: translateX(-50%) translateY(-20px);
        }
        to {
          opacity: 1;
          transform: translateX(-50%) translateY(0);
        }
      }
      
      @keyframes eventPulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.1); }
      }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loadingScreen">
        <!-- Floating Kingdom Decorations -->
        <div class="loading-decoration">👑</div>
        <div class="loading-decoration">💰</div>
        <div class="loading-decoration">🏰</div>
        <div class="loading-decoration">⚔️</div>
        <div class="loading-decoration">💎</div>
        <div class="loading-decoration">🎖️</div>
        
        <div class="loading-logo">👑 EmpireClick</div>
        <div class="loading-message" id="loadingMessage">Initializing...</div>
        <div class="loading-progress">
            <div class="loading-bar" id="loadingBar"></div>
        </div>
        <div class="loading-percentage" id="loadingPercentage">0%</div>
        <div class="loading-spinner"></div>
        <div class="loading-subtitle">Conquer the World • Become Ruler • Made by RevEmpire</div>
        
        <div class="loading-messages">
            <div class="loading-tip" id="loadingTip">Loading your empire...</div>
        </div>
    </div>
    
    <!-- Admin Access Link -->
    <a href="#" class="admin-link" onclick="showAdminLogin()" title="Admin Panel (Ctrl+Shift+A)">🔧</a>
    
    <!-- Admin Shortcut Hint -->
    <div class="admin-shortcut-hint" title="Admin Access">
        Ctrl+Shift+A
    </div>
    
    <!-- Admin Login Modal -->
    <div id="adminLoginModal" class="admin-login-modal">
        <div class="admin-login-content">
            <h2>👑 Admin Access</h2>
            <div id="loginForm">
                <input type="password" id="adminPassword" placeholder="Enter Admin Password" />
                <button onclick="loginAdmin()">🔓 Login</button>
                <button onclick="hideAdminLogin()">❌ Cancel</button>
                <div id="loginError" class="error" style="display: none;"></div>
            </div>
            <div id="changePasswordForm" style="display: none;">
                <input type="password" id="currentPassword" placeholder="Current Password" />
                <input type="password" id="newPassword" placeholder="New Password" />
                <input type="password" id="confirmPassword" placeholder="Confirm New Password" />
                <button onclick="changeAdminPassword()">🔐 Change Password</button>
                <button onclick="hideAdminLogin()">❌ Cancel</button>
                <div id="passwordError" class="error" style="display: none;"></div>
                <div id="passwordSuccess" class="success" style="display: none;"></div>
            </div>
        </div>
    </div>
    
    <!-- Mobile Orientation Warning -->
    <div id="mobileOrientationWarning" class="mobile-orientation-warning" style="display: none;">
        <div class="orientation-content">
            <div class="orientation-icon">📱</div>
            <h3>Please Rotate Your Device</h3>
            <p>EmpireClick works best in landscape mode</p>
            <div class="orientation-arrow">↻</div>
        </div>
    </div>

    <div class="game-container">
        <div class="world" id="world">
            <div class="ground"></div>
            <!-- Plots will be generated by JavaScript -->
        </div>
        
        <!-- Player -->
        <div class="player" id="player"></div>
        
        <!-- UI Panels -->
        <div class="ui">
            <div>💰 RevCoins: <span id="revCoinsDisplay">1000</span></div>
            <div>⚡ Per Second: <span id="perSecondDisplay">0</span></div>
            <div>📊 Total Earned: <span id="totalEarnedDisplay">0</span></div>
            <div>🏠 Plots Owned: <span id="plotsOwnedDisplay">0</span></div>
            <div>🎯 Finds Left: <span id="findsDisplay">3</span></div>
            <div>🚀 Boost: <span id="boostDisplay">0s</span></div>
            <div>🎲 Draws: <span id="drawsDisplay">0</span></div>
            <div>💎 Premium RevCoins: <span id="premiumRevCoinsDisplay">0</span></div>
        </div>
        
        <!-- Plot Info Panel -->
        <div id="plotInfoPanel" class="plot-info-panel" style="display: none;">
            <div>🏷️ <strong>Name:</strong> <span id="plotNameLabel">N/A</span></div>
            <div>🧍 <strong>Owner:</strong> <span id="plotOwnerLabel">N/A</span></div>
            <div>🎖️ <strong>Rarity:</strong> <span id="plotRarityLabel">N/A</span></div>
        </div>
        
        <!-- Game Panels -->
        <div class="game-panels">
            <!-- Earnings Panel -->
            <div class="panel earnings-section">
                <h3>💰 Earnings & Withdrawal</h3>
                <div class="earnings-display">
                    <div class="current-earnings">
                        <div>Current Earnings: <span id="currentEarningsDisplay">0</span></div>
                        <div>Withdrawal Balance: <span id="withdrawalBalanceDisplay">0</span></div>
                    </div>
                    <div class="earnings-rate">
                        <div>Earnings Rate: <span id="earningsRateDisplay">0</span>/sec</div>
                        <div>Base Rate: <span id="baseEarningsDisplay">0</span>/sec</div>
                    </div>
                    <div class="withdrawal-controls">
                        <button onclick="game.withdrawEarnings()">💰 Withdraw Earnings</button>
                        <button onclick="game.boostEarnings()">🚀 Boost Earnings</button>
                        <div id="withdrawalStatus">Status: Ready</div>
                        <div id="boostStatus">Boost: <span id="boostMultiplier">1.0x</span> (<span id="boostTimeLeft">0s</span>)</div>
                        <!-- BOOST CHIP DISPLAY -->
                        <div class="boost-row">
                          <span class="chip chip-boost" title="Earnings Boost">
                            🚀 <span id="boostMultiplierChip">1.0x</span>
                            <span class="chip-sep">•</span>
                            <span id="boostTimeLeftChip">0m 0s</span>
                          </span>
                          <span class="chip chip-tax" title="Land Property Tax Efficiency">
                            🧮 Efficiency: <span id="taxEfficiencyDisplayChip">100%</span>
                          </span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Daily Login Panel -->
            <div class="panel login-bonus-section">
                <h3>🎁 Daily Login Bonus</h3>
                <div class="login-info">
                    <div>Login Streak: <span id="loginStreakDisplay">0</span> days</div>
                    <div>Bonus Multiplier: <span id="loginBonusDisplay">1.0x</span></div>
                    <div id="loginStatus">Daily login available!</div>
                    <button onclick="game.claimDailyLogin()">🎁 Claim Daily Login</button>
                </div>
            </div>
            
            <!-- Lucky Draw Panel -->
            <div class="panel lucky-draw-section">
                <h3>🎁 Lucky Draw</h3>
                <div class="lucky-draw-info">
                    <div>Draws Left Today: <span id="luckyDrawsLeftDisplay">1 free + 3 paid</span></div>
                    <div>1 free draw + 3 ad draws daily</div>
                    <div style="margin: 10px 0;">
                        <strong>Prize Chances:</strong>
                        <ul style="margin: 5px 0; padding-left: 20px; font-size: 12px;">
                            <li>3% chance: 50 RevCoins</li>
                            <li>10% chance: 15 RevCoins</li>
                            <li>37% chance: 1-5 RevCoins</li>
                            <li>50% chance: Nothing</li>
                        </ul>
                    </div>
                    <div style="font-size: 12px; color: #CCC; margin: 5px 0;">
                        <div>1st draw: Free</div>
                        <div>2nd-4th: Watch ad</div>
                    </div>
                    <button onclick="game.tryLuckyDraw()" style="width: 100%; background: #FF6B35; border: none; color: #fff; padding: 12px; border-radius: 8px; font-weight: 700; cursor: pointer; margin: 8px 0; display: flex; align-items: center; justify-content: center; gap: 8px;">
                        🎁 Try Your Luck
                    </button>
                </div>
            </div>
            
            <!-- Find System Panel -->
            <div class="panel find-system-section">
                <h3>🔍 Find System</h3>
                <div class="find-info">
                    <div>Finds Available: <span id="findsAvailableDisplay">3</span></div>
                    <div style="font-size: 12px; color: #CCC; margin: 5px 0;">
                        Use finds to explore claimed plots
                    </div>
                    <button onclick="game.watchAdForFinds()" style="width: 100%; background: #FF6B35; border: none; color: #fff; padding: 12px; border-radius: 8px; font-weight: 700; cursor: pointer; margin: 8px 0; display: flex; align-items: center; justify-content: center; gap: 8px;">
                        📺 Watch Ad (+2 Finds)
                    </button>
                    <div style="font-size: 12px; color: #CCC; margin: 5px 0;">
                        <strong>Success Rates:</strong>
                        <ul style="margin: 5px 0; padding-left: 20px;">
                            <li>Higher rarity = better success rate</li>
                            <li>Legendary plots: 70% success</li>
                            <li>Common plots: 50% success</li>
                        </ul>
                    </div>
                </div>
            </div>
            
            <!-- King's Draw Panel -->
            <div class="panel kings-draw-section">
                <h3>👑 King's Draw</h3>
                <div>Entries: <span id="kingsDrawEntriesDisplay">0</span></div>
                <div>Pool: <span id="kingsDrawPoolDisplay">0</span></div>
                <div>Countdown: <span id="kingsDrawCountdownDisplay">7 days</span></div>
                <button onclick="game.enterKingsDraw()">🎲 Enter Draw (100 RevCoins)</button>
                <button onclick="game.claimKingsDraw()">🏆 Claim Prize</button>
                <div class="winners-board">
                    <h4>🏆 Previous Winners</h4>
                    <div id="winnersList">No winners yet</div>
                </div>
            </div>
            
            <!-- Tax Panel -->
            <div class="panel tax-section">
                <h3>💰 Land Property Tax</h3>
                <div>Tax Status: <span id="taxStatusDisplay">Active</span></div>
                <div>Efficiency: <span id="taxEfficiencyDisplay">100%</span></div>
                <div>Next Tax: <span id="nextTaxDisplay">6 hours</span></div>
                <div style="margin: 10px 0; font-size: 12px; color: #CCC;">
                    <strong>Clear by 3 ads or pay 125 PRC</strong>
                </div>
                <button onclick="game.payTax()" style="width: 100%; background: #dc3545; border: none; color: #fff; padding: 12px; border-radius: 8px; font-weight: 700; cursor: pointer; margin: 8px 0;">
                    💸 Pay 125 PRC
                </button>
                <button onclick="game.boostTax()" style="width: 100%; background: #28A745; border: none; color: #fff; padding: 12px; border-radius: 8px; font-weight: 700; cursor: pointer; margin: 8px 0;">
                    📺 Watch Ad (Progress: <span id="propertyTaxProgress">0/3</span>)
                </button>
                <div>Treasury Pool: <span id="treasuryPoolDisplay">0</span></div>
            </div>
            
            <!-- Wealth Tax Panel -->
            <div class="panel wealth-tax-section">
                <h3>💰 Wealth Tax</h3>
                <div>Efficiency: <span id="wealthTaxEfficiencyDisplay">100%</span></div>
                <div>Tax bypass: <span id="wealthTaxBypassDisplay">0m</span></div>
                <button onclick="game.watchWealthTaxAd()" style="width: 100%; background: #FF6B35; border: none; color: #fff; padding: 12px; border-radius: 8px; font-weight: 700; cursor: pointer; margin: 8px 0; display: flex; align-items: center; justify-content: center; gap: 8px;">
                    📺 Watch Ad to Remove Wealth Tax (30 mins)
                </button>
                <div style="margin-top: 10px; font-size: 12px; color: #CCC;">
                    <strong>Efficiency Logic:</strong>
                    <ul style="margin: 5px 0; padding-left: 20px;">
                        <li>• 0-150 plots: 100% efficiency</li>
                        <li>• 151-300 plots: 50% efficiency</li>
                        <li>• 301+ plots: 20% efficiency</li>
                    </ul>
                </div>
            </div>
            
            <!-- Takeover Panel -->
            <div class="panel takeover-section">
                <h3>👉 Plot Takeover Zone</h3>
                <div>Reclaim abandoned plots for 125 Premium RevCoins (100% to Treasury)</div>
                <div id="takeoverPlotsList" class="takeover-plots-list">
                    <!-- Plot entries will be populated here -->
                </div>
                <div id="takeoverStatus">Status: Ready</div>
                <button onclick="game.simulateWatchAdForPRC()" style="width: 100%; background: #28A745; border: none; color: #fff; padding: 8px; border-radius: 6px; font-weight: 600; cursor: pointer; margin-top: 8px;">
                    📺 Demo: Watch Ad for PRC (5-15 PRC)
                </button>
                <button onclick="game.testOfflineEarnings()" style="width: 100%; background: #FF6B35; border: none; color: #fff; padding: 8px; border-radius: 6px; font-weight: 600; cursor: pointer; margin-top: 8px;">
                    🧪 Test Offline Earnings
                </button>
            </div>
            
            <!-- Treasury Panel -->
            <div class="panel treasury-section">
                <h3>🏛️ Treasury</h3>
                <div>Treasury Balance: <span id="treasuryBalanceDisplay">0</span></div>
                <div>Your Share: <span id="treasuryShareDisplay">0</span></div>
                <button onclick="game.claimTreasury()">💰 Claim Treasury Share</button>
                <button onclick="game.donateToTreasury()">💝 Donate to Treasury</button>
            </div>
            
            <!-- Stats Panel -->
            <div class="panel stats-panel">
                <h3>📊 Statistics</h3>
                <div>Total Plots: <span id="totalPlotsDisplay">500</span></div>
                <div>Plots Owned: <span id="plotsOwnedStatsDisplay">0</span></div>
                <div>Total Earnings: <span id="totalEarningsStatsDisplay">0</span></div>
                <div>Login Streak: <span id="loginStreakStatsDisplay">0</span> days</div>
                <div>Achievement Points: <span id="achievementPointsDisplay">0</span></div>
                <div>Current Rank: <span id="currentRankDisplay">Peasant</span></div>
                <div class="rank-progress">
                    <div>Progress to Next Rank:</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="rankProgressFill" style="width: 0%"></div>
                    </div>
                    <div id="rankProgressText">0 / 10 plots</div>
                </div>
            </div>
            
            <!-- Achievements Panel -->
            <div class="panel achievements-section">
                <h3>🏆 Achievements</h3>
                <div>Achievement Points: <span id="achievementPointsPanelDisplay">0</span></div>
                <button onclick="game.showAchievements()">🏆 View Achievements</button>
                <div id="recentAchievements">No achievements yet</div>
            </div>
            
            <!-- Leaderboard Panel -->
            <div class="panel leaderboard-section">
                <h3>🏆 Leaderboard</h3>
                <button onclick="game.showLeaderboard()">📊 View Leaderboard</button>
                <div id="topPlayers">Loading...</div>
            </div>
            
            <!-- Empire Progression Panel -->
            <div class="panel empire-progression-section">
                <h3>🏰 Empire Progression</h3>
                <div>Current Rank: <span id="empireRankDisplay">Peasant</span></div>
                <div>Next Rank: <span id="nextRankDisplay">Knight</span></div>
                <div class="rank-progress">
                    <div>Progress:</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="empireProgressFill" style="width: 0%"></div>
                    </div>
                    <div id="empireProgressText">0 / 10 plots</div>
                </div>
                <div>Rank Benefits:</div>
                <div id="rankBenefits">No benefits yet</div>
            </div>
            
            <!-- Event Panel -->
            <div class="panel">
                <h3>🔥 Current Event</h3>
                <div>Event: <span id="currentEventDisplay">None</span></div>
                <div>Time Left: <span id="eventTimerDisplay">0h 0m 0s</span></div>
                <div>Effect: <span id="eventEffectDisplay">No effect</span></div>
                <button onclick="game.watchAuditAd()" id="auditButton" style="display: none;">⚖️ Resolve Audit</button>
            </div>
        </div>
        
        <!-- Controls -->
        <div class="controls">
            <div>WASD - Move</div>
            <div>Mouse - Look around</div>
            <div>Click plots to claim</div>
        </div>
        
        <!-- Minimize Button for Logic Panels -->
        <button id="toggleMiddleUI" onclick="toggleMiddleUIPanel()" style="position: fixed; top: 20px; left: 520px; z-index: 1001; background: rgba(0,0,0,0.8); color: white; border: 2px solid gold; border-radius: 5px; padding: 8px 12px; cursor: pointer; font-size: 12px;">🔽 Hide Info Panels</button>
        

        
        <!-- Navigation Panel -->
        <div class="navigation-panel">
            <h3>🧭 Navigation</h3>
            <div class="nav-quadrants">
                <button onclick="game.navigateToQuadrant('NW')">NW</button>
                <button onclick="game.navigateToQuadrant('NE')">NE</button>
                <button onclick="game.navigateToQuadrant('SW')">SW</button>
                <button onclick="game.navigateToQuadrant('SE')">SE</button>
            </div>
            <div class="nav-region-toggle">
                <span>Region:</span>
                <button onclick="game.toggleRegion()">Toggle</button>
            </div>
            <div class="current-region">Current: <span id="currentRegionDisplay">Default</span></div>
        </div>
    </div>
    
    <!-- Modals -->
    <div class="modal" id="explorationModal">
        <div class="modal-content">
            <h3>🔍 Plot Exploration</h3>
            <div id="explorationInfo"></div>
            <div class="exploration-info">
                <div>Plot: <span id="explorationPlotName"></span></div>
                <div>Rarity: <span id="explorationRarity"></span></div>
                <div>Current Earnings: <span id="explorationEarnings"></span>/sec</div>
                <div>Success Rate: <span id="explorationSuccessRate"></span>%</div>
                <div class="exploration-count">Explorations left: <span id="explorationCount"></span></div>
            </div>
            <div class="modal-buttons">
                <button onclick="game.explorePlot()">🔍 Explore</button>
                <button onclick="game.closeExplorationModal()">❌ Cancel</button>
            </div>
        </div>
    </div>
    
    <div class="modal" id="achievementsModal">
        <div class="modal-content achievements-modal">
            <div class="achievements-header">
                <h3>🏆 Achievements</h3>
                <button onclick="game.closeAchievementsModal()">❌ Close</button>
            </div>
            <div class="achievements-list" id="achievementsList">
                <!-- Achievements will be populated here -->
            </div>
        </div>
    </div>
    
    <div class="modal" id="leaderboardModal">
        <div class="modal-content leaderboard-modal">
            <div class="leaderboard-header">
                <h3>🏆 Leaderboard</h3>
                <button onclick="game.closeLeaderboardModal()">❌ Close</button>
            </div>
            <div class="leaderboard-list" id="leaderboardList">
                <!-- Leaderboard will be populated here -->
            </div>
        </div>
    </div>
    
    <!-- Game Message Modal -->
    <div class="game-message" id="gameMessage"></div>
    
    <!-- TOAST CONTAINER -->
    <div id="toastContainer" class="toast-container"></div>
    
    <!-- Event Notification Banner -->
    <div id="eventNotification" class="event-notification" style="display: none;">
        <div class="event-notification-content">
            <div class="event-icon">🎉</div>
            <div class="event-info">
                <div class="event-title">Special Event Active!</div>
                <div class="event-name" id="eventNotificationName">Event Name</div>
                <div class="event-timer" id="eventNotificationTimer">Time Left</div>
            </div>
            <button class="event-close-btn" onclick="game.hideEventNotification()">✕</button>
        </div>
    </div>
    
    <!-- Your logic files -->
    <script src="game.js"></script>
    <script src="ui.js"></script>
    <script src="sprites.js"></script> <!-- your PNG renderer -->
    <script src="game.actions.js"></script> <!-- includes offline earnings logic -->
    
    <script>
      // Initialize the game
      let game;
      document.addEventListener('DOMContentLoaded', function() {
        try {
          console.log('Initializing EmpireClick game...');
          game = new EmpireClickGame();
          window.game = game;
          console.log('Game initialized successfully!');
        } catch (error) {
          console.error('Error initializing game:', error);
        }
      });
      
      // Simple sprite rendering - just display castle images on plots
       window.renderModelOnPlot = function(plotElement, rarity) {
        console.log('Rendering sprite for rarity:', rarity);
        
        // Clear old content but keep tooltip
        const tooltip = plotElement.querySelector('.plot-tooltip');
        plotElement.innerHTML = '';
        if (tooltip) {
          plotElement.appendChild(tooltip);
        }
        
        // Sprite image paths
        const spriteURLs = {
          Common: [
            'assets/images/Castles/common_barn.png',
            'assets/images/Castles/common_cottage.png', 
            'assets/images/Castles/common_hut.png'
          ],
          Rare: [
            'assets/images/Castles/rare_fortress.png',
            'assets/images/Castles/rare_tower.png',
            'assets/images/Castles/rare_gatehouse.png'
          ],
          Epic: [
            'assets/images/Castles/epic_castle.png',
            'assets/images/Castles/epic_keep.png'
          ],
          Legendary: [
            'assets/images/Castles/legendary_keep.png',
            'assets/images/Castles/legendary_palace.png'
          ],
          Elite: [
            'assets/images/Castles/elite_colosseum.png'
          ]
        };
        
        // Pick a random sprite for the rarity
        let sprites = spriteURLs[rarity] || spriteURLs.Common;
        const spriteUrl = sprites[Math.floor(Math.random() * sprites.length)];
        
        // Create image element
        const img = document.createElement('img');
        img.src = spriteUrl;
        img.alt = `${rarity} Castle`;
        img.style.cssText = `
          position: absolute;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          max-width: 90%;
          max-height: 90%;
          object-fit: contain;
          pointer-events: none;
          z-index: 2;
        `;
        
        img.onload = function() {
          console.log('Sprite loaded successfully:', spriteUrl);
        };
        
        img.onerror = function() {
          console.error('Error loading sprite:', spriteUrl);
          // Fallback: show colored square
          img.style.display = 'none';
          const fallback = document.createElement('div');
          fallback.style.cssText = `
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 60%;
            height: 60%;
            background-color: ${getRarityColor(rarity)};
            border: 2px solid #fff;
            border-radius: 4px;
            z-index: 2;
          `;
          plotElement.appendChild(fallback);
        };
        
        plotElement.appendChild(img);
        console.log('Sprite image added to plot');
      };
      
      // Helper function for rarity colors (fallback)
      function getRarityColor(rarity) {
        const colors = {
          Common: '#8B4513',
          Rare: '#4169E1',
          Epic: '#9932CC', 
          Legendary: '#FFD700',
          Elite: '#FF4500'
        };
        return colors[rarity] || '#666';
      }
      
      /* ====== TOAST HELPER ====== */
      window.toast = function(message, type='success', ms=3000){
        const c = document.getElementById('toastContainer'); 
        if (!c) return alert(message);
        const el = document.createElement('div');
        el.className = `toast ${type}`;
        el.textContent = message;
        c.appendChild(el);
        setTimeout(() => {
          el.style.transition = 'opacity .2s ease, transform .2s ease';
          el.style.opacity = '0'; el.style.transform = 'translateY(4px) scale(.98)';
          setTimeout(()=> el.remove(), 220);
        }, ms);
      };

      /* ====== BOOST LOGIC (FREE VIA ADS / EVENTS) ====== */
      (function(){
        const P = EmpireClickGame?.prototype; if(!P) return;

        // Display updater for chip elements
        if (!P.updateBoostUIChips) {
          P.updateBoostUIChips = function(){
            const m = document.getElementById('boostMultiplierChip');
            const t = document.getElementById('boostTimeLeftChip');
            const taxEff = document.getElementById('taxEfficiencyDisplayChip');
            const secs = Math.max(0, this.boostSecondsRemaining|0);
            const mm = Math.floor(secs/60), ss = secs%60;
            if (m) m.textContent = (this.boostSecondsRemaining > 0 ? '2.0' : '1.0') + 'x';
            if (t) t.textContent = `${mm}m ${ss}s`;
            if (taxEff) {
              const eff = this.getEfficiencyMultiplier ? this.getEfficiencyMultiplier() : 1.0;
              taxEff.textContent = Math.round(eff*100)+'%';
            }
          };
        }

        // Override existing updateBoostUI to also update chips
        const originalUpdateBoostUI = P.updateBoostUI;
        P.updateBoostUI = function(){
          if (originalUpdateBoostUI) originalUpdateBoostUI.call(this);
          this.updateBoostUIChips();
        };

        // Timer tick for chips
        if (!P.__chipBoostTickerAttached) {
          P.__chipBoostTickerAttached = true;
          setInterval(() => {
            if (!window.game) return;
            if ((game.boostSecondsRemaining||0) > 0) {
              game.boostSecondsRemaining--;
              game.updateBoostUIChips?.();
            }
          }, 1000);
        }
      })();
    </script>
    
    <!-- ===== RevEmpire: PRC + Progression Fix Patch (drop at end of index.html) ===== -->
    <script>
    (function(){
      /* ---------- tiny helpers ---------- */
      const $ = id => document.getElementById(id);
      const safeToast = (msg, type='success') => {
        try { window.toast ? window.toast(msg, type) : alert(msg); }
        catch { alert(msg); }
      };

      /* ---------- CONFIG (tweak here only) ---------- */
      const CFG = {
        // PRC sinks/sources
        ELITE_PLOT_COST_PRC: 1000,   // claim Elite uses PRC
        TAKEOVER_TOTAL_PRC: 125,     // takeover costs 125 PRC total
        TAKEOVER_TREASURY_PRC: 25,   // 25 PRC goes to Treasury from takeover
        AUDIT_CLEAR_PRC: 100,        // pay 100 PRC to clear Audit infraction
        // PRC ad earning
        PRC_AD_REWARD: 1,            // +1 PRC per ad
        PRC_AD_DAILY_CAP: 20,        // max per calendar day
        PRC_AD_COOLDOWN_MS: 30_000,  // 30s between PRC ad claims
        // Audit trigger
        TAX_OVERDUE_DAYS_FOR_AUDIT: 3,
        // Rank thresholds (plots owned)
        RANKS: [
          { name: 'Peasant', plots: 0   },
          { name: 'Knight',  plots: 10  },
          { name: 'Lord',    plots: 50  },
          { name: 'King',    plots: 100 }
        ]
      };

      /* ---------- Attach once game class exists ---------- */
      function attach(){
        if (typeof EmpireClickGame !== 'function') return;
        const P = EmpireClickGame.prototype;

        /* ===== PREMIUM REVCOINS (PRC) CORE ===== */
        P.updatePremiumRevCoinsUI = P.updatePremiumRevCoinsUI || function(){
          const el = $('premiumRevCoinsDisplay');
          if (el) el.textContent = Math.floor(this.premiumRevCoins || 0);
        };
        P.addPremiumRevCoins = P.addPremiumRevCoins || function(n=0, reason=''){
          n = Math.max(0, Math.floor(n)); if (!n) return;
          this.premiumRevCoins = (this.premiumRevCoins||0) + n;
          this.updatePremiumRevCoinsUI();
          safeToast(`+${n} Premium RevCoins${reason?` — ${reason}`:''}`);
        };
        P.canSpendPremiumRevCoins = P.canSpendPremiumRevCoins || function(cost=0){
          return (this.premiumRevCoins||0) >= Math.max(0, Math.floor(cost));
        };
        P.spendPremiumRevCoins = P.spendPremiumRevCoins || function(cost=0, reason=''){
          cost = Math.max(0, Math.floor(cost));
          if ((this.premiumRevCoins||0) < cost) return false;
          this.premiumRevCoins -= cost;
          this.updatePremiumRevCoinsUI();
          if (cost) safeToast(`Spent ${cost} Premium RevCoins${reason?` — ${reason}`:''}`, 'warn');
          return true;
        };
        P.addTreasuryPRC = P.addTreasuryPRC || function(amount=0, reason=''){
          amount = Math.max(0, Math.floor(amount)); if (!amount) return;
          this.treasuryPRC = (this.treasuryPRC||0) + amount;
          const tEl = $('treasuryPRCDisplay'); if (tEl) tEl.textContent = Math.floor(this.treasuryPRC);
          safeToast(`Treasury +${amount} PRC${reason?` — ${reason}`:''}`, 'success');
        };

        /* ===== PRC: USE CASES ===== */
        // 1) Elite plot purchase uses PRC
        const _confirmClaimPlot = P.confirmClaimPlot;
        P.confirmClaimPlot = function(){
          // preview rarity using your existing flow
          if (!this.plotToClaim) { if (typeof _confirmClaimPlot === 'function') return _confirmClaimPlot.call(this); return; }

          // calculate rarity before charging
          const rarity = this.getRandomRarity ? this.getRandomRarity() : 'Common';
          this.pendingRarity = rarity;

          let coinCost = 100;
          if (this.activeEvent === 'Construction Discount' && rarity !== 'Elite') coinCost = 50;

          if (rarity === 'Elite') {
            const need = CFG.ELITE_PLOT_COST_PRC;
            if (!this.canSpendPremiumRevCoins(need)) { safeToast(`Need ${need} Premium RevCoins for Elite plot.`, 'error'); return; }
            this.spendPremiumRevCoins(need, 'Elite Plot');
          } else {
            if ((this.revCoins||0) < coinCost) { safeToast(`Need ${coinCost} RevCoins for ${rarity} plot.`, 'error'); return; }
            this.revCoins -= coinCost;
          }

          // proceed with your original post-purchase logic
          this.earnings += (this.rarityRates?.[rarity] || 0);

          const p = this.plotToClaim;
          p.claimed = true;
          p.owner  = this.playerName || 'Player';
          p.rarity = rarity;
          p.name   = this.generatePlotName ? this.generatePlotName() : ('Plot ' + (p.index+1));
          p.element.classList.add('claimed', rarity);

          const t = p.element.querySelector('.plot-tooltip');
          if (t){
            const buildingType = this.getBuildingName ? this.getBuildingName(rarity) : rarity;
            const e = this.rarityRates?.[rarity] || 0;
            t.innerHTML = `<strong>${p.name}</strong><br>Building: ${buildingType}<br>Rarity: ${rarity}<br>Owner: ${p.owner}<br>Earnings: ${e.toFixed(8)}/sec<br>Explorations: 3 left`;
          }

          this.plotsClaimed = (this.plotsClaimed||0) + 1;

          // NEW: update achievements + rank + UI immediately
          this.checkAchievements?.();
          this.updateRankUI?.();
          this.updateUI?.();
          this.updateEarningsDisplay?.();

          // PNG sprite hook (no three.js)
          if (typeof window.renderModelOnPlot === 'function') {
            try { window.renderModelOnPlot(p.element, rarity); } catch(e){}
          }

          // Update quick info panel
          const nEl=$('plotNameLabel'), oEl=$('plotOwnerLabel'), rEl=$('plotRarityLabel'), panel=$('plotInfoPanel');
          if (nEl) nEl.textContent = p.name;
          if (oEl) oEl.textContent = p.owner;
          if (rEl){ rEl.textContent = rarity; rEl.style.color = (this.getRarityColor?.(rarity) || '#ffd700'); }
          if (panel) panel.style.display = 'block';

          safeToast(`🏗️ Claimed a ${rarity} plot${rarity==='Elite'?' (PRC)':''}!`);
        };

        // 2) Land Takeover (125 PRC total, 25 to Treasury)
        const _initiateTakeover = P.initiateTakeover;
        P.initiateTakeover = function(){
          const total = CFG.TAKEOVER_TOTAL_PRC;
          const cut   = CFG.TAKEOVER_TREASURY_PRC;
          if (!this.canSpendPremiumRevCoins(total)) { safeToast(`Need ${total} Premium RevCoins for takeover.`, 'error'); return; }
          this.spendPremiumRevCoins(total, 'Land Takeover');
          if (cut) this.addTreasuryPRC(cut, 'Takeover Admin Share');

          this.takeoverActive = true;
          this.takeoverEndsAt = Date.now() + 5*60*1000;
          const st=$('takeoverStatus'); if (st) st.textContent = 'Takeover in progress...';
          this.updateUI?.();
          safeToast(`⚔️ Takeover started (Treasury +${cut} PRC).`, 'warn');
          // Do not call original to avoid double-charging; we covered essentials.
        };

        // 3) Audit Infraction clear with PRC (100 PRC)
        P.payAuditInfractionWithPRC = function(){
          const need = CFG.AUDIT_CLEAR_PRC;
          if (!this.auditFineActive) { safeToast('No active audit infraction.', 'warn'); return; }
          if (!this.canSpendPremiumRevCoins(need)) { safeToast(`Need ${need} Premium RevCoins to clear audit.`, 'error'); return; }
          this.spendPremiumRevCoins(need, 'Audit Infraction');
          this.addTreasuryPRC(need, 'Audit Infraction Payment');
          this.clearAuditInfraction?.('paid 100 PRC');
        };

        // 4) Donate PRC directly to Treasury
        P.donatePremiumRevCoins = P.donatePremiumRevCoins || function(amount=1){
          const n = Math.max(0, Math.floor(amount)); if (!n) return;
          if (!this.canSpendPremiumRevCoins(n)) { safeToast('Not enough PRC to donate.', 'error'); return; }
          this.spendPremiumRevCoins(n, 'Donation');
          this.addTreasuryPRC(n, 'Player Donation');
        };

        // 5) Earn PRC by watching ads (daily cap + cooldown)
        if (P.prcAdDayKey == null)     P.prcAdDayKey = new Date().toDateString();
        if (P.prcAdTodayCount == null) P.prcAdTodayCount = 0;
        if (P.prcAdNextTime == null)   P.prcAdNextTime = 0;
        P.watchPremiumRevcoinAd = function(){
          const today = new Date().toDateString();
          if (this.prcAdDayKey !== today){ this.prcAdDayKey = today; this.prcAdTodayCount = 0; }
          const left = CFG.PRC_AD_DAILY_CAP - (this.prcAdTodayCount||0);
          if (left <= 0) { safeToast('Daily PRC ad limit reached.', 'warn'); return; }
          const now = Date.now();
          if (now < (this.prcAdNextTime||0)) return; // still cooling

          // …show ad SDK; on reward:
          this.prcAdTodayCount++;
          this.prcAdNextTime = now + CFG.PRC_AD_COOLDOWN_MS;
          this.addPremiumRevCoins(CFG.PRC_AD_REWARD, 'Ad Reward');
          // update any small UI in your earn PRC panel if present
          if (typeof this.updatePRCAdUI === 'function') this.updatePRCAdUI();
        };

        /* ===== DAILY LOGIN: FIX STREAK & BONUS UI ===== */
        const _claimDailyLogin = P.claimDailyLogin;
        P.claimDailyLogin = function(){
          // call original if present for RNG bonus etc.
          if (typeof _claimDailyLogin === 'function') _claimDailyLogin.call(this);

          // ensure once-per-day
          const today = new Date().toDateString();
          if (this.lastLoginDate !== today){
            this.lastLoginDate = today;
            this.loginStreak   = (this.loginStreak||0) + 1;
            // you already compute dailyLoginBonus elsewhere; keep if set
            if (!this.dailyLoginBonus) this.dailyLoginBonus = 1.0;
          }
          this.dailyLoginAvailable = false;

          // UI reflect
          const ls1=$('loginStreakDisplay'), ls2=$('loginStreakStatsDisplay');
          if (ls1) ls1.textContent = this.loginStreak||0;
          if (ls2) ls2.textContent = this.loginStreak||0;
          const lb=$('loginBonusDisplay'); if (lb) lb.textContent = (this.dailyLoginBonus||1).toFixed(2)+'x';
          const ls=$('loginStatus'); if (ls) ls.textContent = 'Daily bonus claimed!';
          // recompute earnings (daily bonus multiplies)
          this.startEarnings?.();
          this.updateUI?.();
          safeToast('🎁 Daily login claimed. Streak updated.');
        };

        /* ===== ACHIEVEMENTS: ensure points & recent list update ===== */
        P.grantAchievementNow = P.grantAchievementNow || function(ach){
          if (!ach || ach.completed) return;
          ach.completed = true;
          this.achievementPoints = (this.achievementPoints||0) + (ach.points||0);

          // UI counters
          const ap1=$('achievementPointsDisplay'), ap2=$('achievementPointsPanelDisplay');
          if (ap1) ap1.textContent = this.achievementPoints;
          if (ap2) ap2.textContent = this.achievementPoints;

          // Recent list (if exists)
          const recent=$('recentAchievements');
          if (recent){
            const row = document.createElement('div');
            row.className = 'achievement-item completed';
            row.innerHTML = `<span class="achievement-icon">${ach.icon||'🏆'}</span><div><div>${ach.name||'Achievement'}</div><small>${ach.description||''}</small></div>`;
            recent.prepend(row);
          }
          safeToast(`🏆 Achievement Unlocked: ${ach.name||'Achievement'} (+${ach.points||0})`);
        };

        const _checkAchievements = P.checkAchievements;
        P.checkAchievements = function(){
          if (typeof _checkAchievements === 'function') _checkAchievements.call(this);
          // also re-paint points if missed
          const ap1=$('achievementPointsDisplay'), ap2=$('achievementPointsPanelDisplay');
          if (ap1) ap1.textContent = this.achievementPoints||0;
          if (ap2) ap2.textContent = this.achievementPoints||0;
          // if you want: unlock directly when conditions met (safety pass)
          if (Array.isArray(this.achievements)){
            this.achievements.forEach(a => {
              if (a.completed) return;
              let ok = false;
              switch(a.id){
                case 'first_plot':      ok = (this.plotsClaimed||0) >= 1; break;
                case 'knight_rank':     ok = (this.plotsClaimed||0) >= 10; break;
                case 'lord_rank':       ok = (this.plotsClaimed||0) >= 50; break;
                case 'king_rank':       ok = (this.plotsClaimed||0) >= 100; break;
                case 'ten_plots':       ok = (this.plotsClaimed||0) >= 10; break;
                case 'fifty_plots':     ok = (this.plotsClaimed||0) >= 50; break;
                case 'hundred_plots':   ok = (this.plotsClaimed||0) >= 100; break;
              }
              if (ok) this.grantAchievementNow(a);
            });
          }
        };

        /* ===== RANK PROGRESSION: compute + paint ===== */
        P.computeRankFromPlots = P.computeRankFromPlots || function(){
          const owned = this.plotsClaimed||0;
          const ranks = CFG.RANKS;
          let current = ranks[0], next = null;
          for (let i=0; i<ranks.length; i++){
            if (owned >= ranks[i].plots) { current = ranks[i]; next = ranks[i+1]||null; }
          }
          return { current, next, owned };
        };

        P.updateRankUI = P.updateRankUI || function(){
          const { current, next, owned } = this.computeRankFromPlots();
          // labels
          const cur1=$('currentRankDisplay'), cur2=$('empireRankDisplay');
          if (cur1) cur1.textContent = current.name;
          if (cur2) cur2.textContent = current.name;
          const nextEl=$('nextRankDisplay'); if (nextEl) nextEl.textContent = next? next.name : 'Max';
          // progress text + bar
          const need = next ? next.plots : Math.max(owned, 1);
          const have = Math.min(owned, need);
          const pct  = next ? Math.round((have - current.plots) / (need - current.plots) * 100) : 100;

          const rFill=$('rankProgressFill'), rText=$('rankProgressText');
          if (rFill) rFill.style.width = pct + '%';
          if (rText) rText.textContent = `${owned} / ${next? next.plots : owned} plots`;

          const eFill=$('empireProgressFill'), eText=$('empireProgressText');
          if (eFill) eFill.style.width = pct + '%';
          if (eText) eText.textContent = `${owned} / ${next? next.plots : owned} plots`;

          // mirror into stats panel
          const ownedStats=$('plotsOwnedStatsDisplay'); if (ownedStats) ownedStats.textContent = owned;
        };

        /* ===== AUDIT: auto-trigger if tax overdue 3 days; then user clears via 3 ads or 100 PRC ===== */
        P.checkAuditInfractionOnReturn = P.checkAuditInfractionOnReturn || function(){
          const lastPaid = this.lastTaxPaid || 0;
          const overdueMs = Date.now() - lastPaid;
          const needMs = CFG.TAX_OVERDUE_DAYS_FOR_AUDIT * 24*60*60*1000;
          if (overdueMs > needMs) {
            this.auditFineActive = true;
            this.auditFineRequired = 3;
            this.auditFineAdsWatched = this.auditFineAdsWatched||0;
            safeToast('⚠️ Audit infraction: 3 ads or pay 100 PRC to proceed.', 'warn');
            // if you have an Audit button in UI, ensure it shows
            const btn = $('auditButton'); if (btn) btn.style.display = 'inline-block';
            this.updateUI?.();
          }
        };

        // Respect your existing watchAuditAd if present; otherwise define a simple one:
        const _watchAuditAd = P.watchAuditAd;
        P.watchAuditAd = function(){
          if (typeof _watchAuditAd === 'function') return _watchAuditAd.call(this);
          if (!this.auditFineActive) { safeToast('No active audit infraction.', 'warn'); return; }
          this.auditFineAdsWatched = (this.auditFineAdsWatched||0) + 1;
          if (this.auditFineAdsWatched >= (this.auditFineRequired||3)) {
            this.clearAuditInfraction?.('watched 3 audit ads');
          } else {
            safeToast(`Audit ad watched (${this.auditFineAdsWatched}/${this.auditFineRequired||3}).`);
          }
        };

        P.clearAuditInfraction = P.clearAuditInfraction || function(reason=''){
          this.auditFineActive = false;
          this.auditFineAdsWatched = 0;
          const btn = $('auditButton'); if (btn) btn.style.display = 'none';
          safeToast(`✅ Audit cleared${reason?` — ${reason}`:''}. Now renew property tax (3 ads).`, 'success');
          this.updateUI?.();
        };

        /* ===== INIT HOOK: make sure UI paints correctly on load ===== */
        const _init = P.init;
        P.init = function(){
          if (typeof _init === 'function') _init.call(this);
          // PRC + treasury numbers
          this.updatePremiumRevCoinsUI();
          const tEl = $('treasuryPRCDisplay'); if (tEl) tEl.textContent = Math.floor(this.treasuryPRC||0);
          // Login + rank + achievements
          const ls1=$('loginStreakDisplay'), ls2=$('loginStreakStatsDisplay');
          if (ls1) ls1.textContent = this.loginStreak||0;
          if (ls2) ls2.textContent = this.loginStreak||0;
          const lb=$('loginBonusDisplay'); if (lb) lb.textContent = (this.dailyLoginBonus||1).toFixed(2)+'x';
          this.checkAchievements?.();
          this.updateRankUI?.();
          // Audit on return
          this.checkAuditInfractionOnReturn?.();
        };

        /* ===== Small ticker to keep PRC ad cooldown labels fresh if you added that panel ===== */
        if (!P.__prcAdLabelTicker){
          P.__prcAdLabelTicker = true;
          setInterval(() => {
            if (!window.game) return;
            if (typeof game.updatePRCAdUI === 'function') game.updatePRCAdUI();
          }, 500);
        }
      }

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', attach);
      } else {
        attach();
      }
    })();
    </script>
    <!-- ===== /RevEmpire Patch ===== -->
    
    <!-- Background Music System -->
    <!-- Music controls will be created by game.js -->
    
    <!-- ========= EmpireClick UI Polish Utilities ========= -->
    <script>
      /* ========= EmpireClick Overlay & Message Utils ========= */

      // Toasts
      (function setupToasts(){
        if (document.querySelector(".ec-toast-container")) return;
        const c = document.createElement("div");
        c.className = "ec-toast-container";
        document.body.appendChild(c);
      })();
      
      function showToast(msg, type="info", ms=2400){
        const c = document.querySelector(".ec-toast-container");
        const t = document.createElement("div");
        t.className = `ec-toast ${type}`;
        t.textContent = msg;
        c.appendChild(t);
        setTimeout(()=> {
          t.style.opacity = "0";
          t.style.transform = "translateY(6px)";
          setTimeout(()=> t.remove(), 180);
        }, ms);
      }

      // Game Message (hero banner)
      let _gmTimer = null;
      function showGameMessage(text, {ms=2200} = {}){
        const el = document.getElementById("gameMessage");
        if (!el) return console.warn("No #gameMessage element");
        clearTimeout(_gmTimer);
        el.textContent = text;
        el.style.display = "block";
        _gmTimer = setTimeout(()=> { el.style.display = "none"; }, ms);
      }

      // Modal helpers (works with your .modal / .modal-content)
      function openModal(id){
        const el = document.getElementById(id);
        if (!el) return;
        el.classList.add("is-open");
      }
      function closeModal(id){
        const el = document.getElementById(id);
        if (!el) return;
        el.classList.remove("is-open");
      }
      
      // Optional: click backdrop to close (only if target has .modal)
      document.addEventListener("click", (e)=>{
        const m = e.target.closest(".modal");
        if (m && e.target === m) m.classList.remove("is-open");
      });

      // Plot Info panel API (uses existing #plotInfoPanel)
      function showPlotInfo({name="N/A", owner="Unclaimed", rarity="Unknown"}){
        const box = document.getElementById("plotInfoPanel");
        if (!box) return;
        if (!box.classList.contains("ec-glass")) box.classList.add("ec-glass");

        // Build nice layout once
        if (!box.dataset.wired){
          box.innerHTML = `
            <div class="ec-title" style="margin-bottom:8px;">Plot Details</div>
            <div class="row"><div class="label">Name</div><div class="value" id="piName"></div></div>
            <div class="row"><div class="label">Owner</div><div class="value" id="piOwner"></div></div>
            <div class="row"><div class="label">Rarity</div>
              <div class="value"><span class="tag" id="piRarity"></span></div></div>
          `;
          box.dataset.wired = "1";
        }
        box.querySelector("#piName").textContent = name;
        box.querySelector("#piOwner").textContent = owner;
        box.querySelector("#piRarity").textContent = rarity;

        // Accent by rarity
        const tag = box.querySelector("#piRarity");
        tag.style.borderColor = ({
          Common:"#94a3b8", Rare:"#60a5fa", Epic:"#a78bfa", Legendary:"#f59e0b", Elite:"#10b981"
        }[rarity]||"#94a3b8");

        box.style.display = "block";
      }
      
      function hidePlotInfo(){
        const box = document.getElementById("plotInfoPanel");
        if (box) box.style.display = "none";
      }

      // Export to window if you like calling from game logic
      window.showToast = showToast;
      window.showGameMessage = showGameMessage;
      window.showPlotInfo = showPlotInfo;
      window.hidePlotInfo = hidePlotInfo;
      window.openModal = openModal;
      window.closeModal = closeModal;

      // Test functions for you to try
      window.testToast = function() {
        showToast("🎉 This is a success toast!", "success");
        setTimeout(() => showToast("⚠️ This is a warning toast!", "error"), 1000);
        setTimeout(() => showToast("ℹ️ This is an info toast!", "info"), 2000);
      };
      
      window.testPlotInfo = function() {
        showPlotInfo({
          name: "Golden Valley",
          owner: "Player123",
          rarity: "Legendary"
        });
      };
      
      window.testGameMessage = function() {
        showGameMessage("🔥 Legendary Plot Unlocked!", { ms: 3000 });
      };

      console.log("🎨 EmpireClick UI Polish Pack loaded! Try:");
      console.log("- testToast() - Test the new toast system");
      console.log("- testPlotInfo() - Test the polished plot info panel");
      console.log("- testGameMessage() - Test the hero game message");
    </script>

    <!-- Admin Access System -->
    <script>
        // Admin password management
        const ADMIN_PASSWORD_KEY = 'empireClickAdminPassword';
        
        // Initialize default password if none exists
        if (!localStorage.getItem(ADMIN_PASSWORD_KEY)) {
            localStorage.setItem(ADMIN_PASSWORD_KEY, 'admin123'); // Default password
        }

        // Keyboard shortcut for admin access
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.shiftKey && e.key === 'A') {
                e.preventDefault();
                showAdminLogin();
            }
        });

        function showAdminLogin() {
            document.getElementById('adminLoginModal').style.display = 'block';
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('changePasswordForm').style.display = 'none';
            document.getElementById('adminPassword').focus();
            clearMessages();
        }

        function hideAdminLogin() {
            document.getElementById('adminLoginModal').style.display = 'none';
            clearMessages();
        }

        function loginAdmin() {
            const password = document.getElementById('adminPassword').value;
            const storedPassword = localStorage.getItem(ADMIN_PASSWORD_KEY);
            
            if (password === storedPassword) {
                // Success - redirect to admin panel
                window.location.href = 'admin.html';
            } else {
                showLoginError('❌ Incorrect password!');
            }
        }

        function showChangePasswordForm() {
            document.getElementById('loginForm').style.display = 'none';
            document.getElementById('changePasswordForm').style.display = 'block';
            document.getElementById('currentPassword').focus();
            clearMessages();
        }

        function changeAdminPassword() {
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const storedPassword = localStorage.getItem(ADMIN_PASSWORD_KEY);
            
            // Validate current password
            if (currentPassword !== storedPassword) {
                showPasswordError('❌ Current password is incorrect!');
                return;
            }
            
            // Validate new password
            if (newPassword.length < 6) {
                showPasswordError('❌ New password must be at least 6 characters!');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                showPasswordError('❌ New passwords do not match!');
                return;
            }
            
            // Update password
            localStorage.setItem(ADMIN_PASSWORD_KEY, newPassword);
            showPasswordSuccess('✅ Password changed successfully!');
            
            // Clear form
            document.getElementById('currentPassword').value = '';
            document.getElementById('newPassword').value = '';
            document.getElementById('confirmPassword').value = '';
            
            // Return to login form after 2 seconds
            setTimeout(() => {
                document.getElementById('changePasswordForm').style.display = 'none';
                document.getElementById('loginForm').style.display = 'block';
                document.getElementById('adminPassword').value = '';
                clearMessages();
            }, 2000);
        }

        function showLoginError(message) {
            const errorDiv = document.getElementById('loginError');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            document.getElementById('adminPassword').value = '';
        }

        function showPasswordError(message) {
            const errorDiv = document.getElementById('passwordError');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
        }

        function showPasswordSuccess(message) {
            const successDiv = document.getElementById('passwordSuccess');
            successDiv.textContent = message;
            successDiv.style.display = 'block';
        }

        function clearMessages() {
            document.getElementById('loginError').style.display = 'none';
            document.getElementById('passwordError').style.display = 'none';
            document.getElementById('passwordSuccess').style.display = 'none';
        }

        // Allow Enter key to submit forms
        document.addEventListener('DOMContentLoaded', function() {
            const adminPassword = document.getElementById('adminPassword');
            const currentPassword = document.getElementById('currentPassword');
            
            if (adminPassword) {
                adminPassword.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        loginAdmin();
                    }
                });
            }
            
            if (currentPassword) {
                currentPassword.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        changeAdminPassword();
                    }
                });
            }

            // Add change password link to login form
            const loginForm = document.getElementById('loginForm');
            if (loginForm) {
                const changePasswordLink = document.createElement('div');
                changePasswordLink.innerHTML = '<a href="#" onclick="showChangePasswordForm()" style="color: #fff; text-decoration: underline; font-size: 12px;">Change Password</a>';
                changePasswordLink.style.marginTop = '10px';
                loginForm.appendChild(changePasswordLink);
            }
        });
    </script>
    
    <!-- Loading Screen Script -->
    <script>
        // Loading screen messages
        const loadingMessages = [
            "Conquer the World...",
            "Become Ruler...",
            "Build Your Empire...",
            "Claim Your Kingdom...",
            "Rise to Power...",
            "Dominate the Land...",
            "Establish Your Dynasty...",
            "Rule with Authority...",
            "Expand Your Territory...",
            "Achieve Greatness...",
            "Made by RevEmpire..."
        ];
        
        const loadingTips = [
            "💡 Tip: Click plots to claim them and earn RevCoins!",
            "💡 Tip: Watch ads to get Premium RevCoins and finds!",
            "💡 Tip: Use finds to explore plots for extra rewards!",
            "💡 Tip: Events can boost your earnings significantly!",
            "💡 Tip: The more plots you own, the more you earn!",
            "💡 Tip: Boost your earnings with the boost button!",
            "💡 Tip: Daily login bonuses give you extra rewards!",
            "💡 Tip: Property tax affects your earnings efficiency!",
            "💡 Tip: King's Draw gives you a chance to win big!",
            "💡 Tip: Regions offer different challenges and rewards!"
        ];
        
        let currentMessageIndex = 0;
        let currentTipIndex = 0;
        let loadingProgress = 0;
        
        function updateLoadingMessage() {
            const messageEl = document.getElementById('loadingMessage');
            const tipEl = document.getElementById('loadingTip');
            
            // Fade out current message
            messageEl.classList.remove('show');
            
            setTimeout(() => {
                // Update message
                messageEl.textContent = loadingMessages[currentMessageIndex];
                messageEl.classList.add('show');
                
                // Update tip
                tipEl.classList.remove('show');
                setTimeout(() => {
                    tipEl.textContent = loadingTips[currentTipIndex];
                    tipEl.classList.add('show');
                }, 300);
                
                // Move to next message
                currentMessageIndex = (currentMessageIndex + 1) % loadingMessages.length;
                currentTipIndex = (currentTipIndex + 1) % loadingTips.length;
            }, 500);
        }
        
        function updateLoadingProgress(progress) {
            loadingProgress = progress;
            const barEl = document.getElementById('loadingBar');
            const percentageEl = document.getElementById('loadingPercentage');
            
            barEl.style.width = progress + '%';
            percentageEl.textContent = Math.floor(progress) + '%';
        }
        
        function hideLoadingScreen() {
            const loadingScreen = document.getElementById('loadingScreen');
            loadingScreen.style.opacity = '0';
            setTimeout(() => {
                loadingScreen.style.display = 'none';
            }, 500);
        }
        
        // Start loading sequence
        let messageInterval = setInterval(updateLoadingMessage, 2500);
        updateLoadingMessage(); // Show first message immediately
        
        // Simulate loading progress
        let progressInterval = setInterval(() => {
            if (loadingProgress < 90) {
                updateLoadingProgress(loadingProgress + Math.random() * 8);
            }
        }, 300);
        
        // Hide loading screen when game is ready
        window.addEventListener('load', function() {
            // Wait longer for game initialization (6 seconds total)
            setTimeout(() => {
                updateLoadingProgress(100);
                clearInterval(progressInterval);
                clearInterval(messageInterval);
                
                // Show final message
                const messageEl = document.getElementById('loadingMessage');
                messageEl.textContent = "Ready to Conquer!";
                
                // Hide loading screen after a moment
                setTimeout(hideLoadingScreen, 2000);
            }, 6000);
        });
    </script>
</body>
</html> 